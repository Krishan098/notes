<!DOCTYPE html>
<html lang="en">
  <!-- Head -->
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <!-- Metadata, OpenGraph and Schema.org -->




<!-- Standard metadata -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>
  
  
    
      Q&amp;A Over SQL | Neural Notes
    
  
</title>
<meta name="author" content="Neural Notes">
<meta name="description" content="Notes on Q&amp;A Over SQL">

  <meta name="keywords" content="machine-learning, deep-learning, langchain, langgraph, notes">






  <!-- OpenGraph -->
  <meta property="og:site_name" content="Neural Notes">
  <meta property="og:type" content="article">
  <meta property="og:title" content="Neural Notes | Q&amp;A Over SQL">
  <meta property="og:url" content="https://krishan098.github.io/notes/blog/2024/qa-over-sql/">
  <meta property="og:description" content="Notes on Q&amp;A Over SQL">
  
  <meta property="og:locale" content="en">

  <!-- Twitter card -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Q&amp;A Over SQL">
  <meta name="twitter:description" content="Notes on Q&amp;A Over SQL">
  
  



  <!-- Schema.org -->
  
  
  

  <script type="application/ld+json">
    {
        "author":
        {
            "@type": "Person",
            "name": "Neural Notes"
        },
        "url": "https://krishan098.github.io/notes/blog/2024/qa-over-sql/",
        "@type": "BlogPosting",
        "description": "Notes on Q&A Over SQL",
        "headline": "Q&A Over SQL",
        
        "sameAs": ["https://github.com/Krishan098"],
        
        "name": "Neural Notes",
        "@context": "https://schema.org"
    }
  </script>



<!-- Bootstrap & MDB -->
<link rel="stylesheet" href="/notes/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous">



<!-- Fonts & Icons -->
<link defer rel="stylesheet" href="/notes/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5">
<link defer rel="stylesheet" href="/notes/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772">
<link defer rel="stylesheet" type="text/css" href="">

<!-- Code Syntax Highlighting -->
<link defer rel="stylesheet" href="/notes/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light">


  <!-- Sidebar Table of Contents -->
  <link defer href="/notes/assets/css/bootstrap-toc.min.css?6f5af0bb9aab25d79b2448143cbeaa88" rel="stylesheet">


<!-- Styles -->




  <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%93%9D&lt;/text&gt;&lt;/svg&gt;">

<link rel="stylesheet" href="/notes/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e">
<link rel="canonical" href="https://krishan098.github.io/notes/blog/2024/qa-over-sql/">


  <!-- Dark Mode -->
  <script src="/notes/assets/js/theme.js?a81d82887dd692e91686b43de4542f18"></script>
  <link defer rel="stylesheet" href="/notes/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark">
  <script>
    initTheme();
  </script>










  </head>

  <!-- Body -->
  <body class="fixed-top-nav sticky-bottom-footer">
    <!-- Header -->
    <header>
  <!-- Nav Bar -->
  <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation">
    <div class="container">
      
        <a class="navbar-brand title font-weight-lighter" href="/notes/">
          Neural Notes
        </a>
      
      <!-- Navbar Toggle -->
      <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar top-bar"></span>
        <span class="icon-bar middle-bar"></span>
        <span class="icon-bar bottom-bar"></span>
      </button>

      <div class="collapse navbar-collapse text-right" id="navbarNav">
        <ul class="navbar-nav ml-auto flex-nowrap">
          

          <!-- About -->
          <li class="nav-item ">
            <a class="nav-link" href="/notes/">About
              
            </a>
          </li>

          <!-- Other pages -->
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
                
                <li class="nav-item active">
                  <a class="nav-link" href="/notes/blog/">blog
                    
                  </a>
                </li>
              
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
          
            <!-- Search -->
            <li class="nav-item">
              <button id="search-toggle" title="Search" onclick="openSearchModal()">
                <span class="nav-link">ctrl k <i class="ti ti-search"></i></span>
              </button>
            </li>
          
          
            <!-- Toogle theme mode -->
            <li class="toggle-container">
              <button id="light-toggle" title="Change theme">
                <i class="ti ti-sun-moon" id="light-toggle-system"></i>
                <i class="ti ti-moon-filled" id="light-toggle-dark"></i>
                <i class="ti ti-sun-filled" id="light-toggle-light"></i>
              </button>
            </li>
          
        </ul>
      </div>
    </div>
  </nav>
  
    <!-- Scrolling Progress Bar -->
    <progress id="progress" value="0">
      <div class="progress-container">
        <span class="progress-bar"></span>
      </div>
    </progress>
  
</header>


    <!-- Content -->
    <div class="container mt-5" role="main">
      
        
          <div class="row">
            <!-- sidebar, which will move to the top on a small screen -->
            <div class="col-sm-3">
              <nav id="toc-sidebar" class="sticky-top"></nav>
            </div>
            <!-- main content area -->
            <div class="col-sm-9">






<div class="post">
  <header class="post-header">
    <h1 class="post-title">Q&amp;A Over SQL</h1>
    <p class="post-meta">
      Created on January 14, 2024
      
      
      
    </p>
    <p class="post-tags">
      
        <a href="/notes/blog/2024"> <i class="fa-solid fa-calendar fa-sm"></i> 2024 </a>
      
      
        ¬† ¬∑ ¬†
        
          
            <a href="/notes/blog/tag/langchain"> <i class="fa-solid fa-hashtag fa-sm"></i> langchain</a>
          
          
            ¬†
          
        
          
            <a href="/notes/blog/tag/q-a-over-sql"> <i class="fa-solid fa-hashtag fa-sm"></i> q&amp;a-over-sql</a>
          
          
        
      

      
        ¬† ¬∑ ¬†
        
          
            <a href="/notes/blog/category/langchain"> <i class="fa-solid fa-tag fa-sm"></i> LangChain</a>
          
          
            ¬†
          
        
          
            <a href="/notes/blog/category/q-a-over-sql"> <i class="fa-solid fa-tag fa-sm"></i> Q&amp;A Over SQL</a>
          
          
        
      
    </p>
  </header>

  <article class="post-content">
    
    <div id="markdown-content">
      <h1 id="build-a-questionanswering-system-over-sql-data">Build a Question/Answering system over SQL data</h1>

<ul>
  <li>q&amp;a system over tabular data in databases</li>
</ul>

<h2 id="architecture">Architecture</h2>

<ul>
  <li>
    <p>At a high level, the steps of these systems are:</p>

    <ol>
      <li>
        <p>Convert question to SQL query: model converts user input to a SQL query</p>
      </li>
      <li>
        <p>Execute SQL query</p>
      </li>
      <li>
        <p>Answer the question</p>
      </li>
    </ol>
  </li>
</ul>

<p><img src="/notes/assets/img/posts/image.png" alt="">
m</p>
<h2 id="chains">Chains</h2>

<ul>
  <li>
    <p>chains are compositions of predictable steps.</p>
  </li>
  <li>
    <p>we can represent a chain via simple squence of nodes.</p>
  </li>
</ul>

<h2 id="application-state">Application State</h2>

<ul>
  <li>The LangGraph state of our application controls what data is input to the application, transferred between steps and output by the application.</li>
</ul>

<h2 id="convert-question-to-sql-query">Convert question to SQL query</h2>

<ul>
  <li>the first step is to the user input and convert it to a SQL query.</li>
</ul>

<h3 id="sqldatabase">SQLDATABASE</h3>

<ul>
  <li>
    <p>dialect: return string representation of dialect to use</p>
  </li>
  <li>
    <p>table_info: information about all tables in the database.</p>
  </li>
</ul>

<h2 id="execute-query">Execute query</h2>

<ul>
  <li>
    <p>loads a tool from langchain_community</p>
  </li>
  <li>
    <p>most dangerous part of creating a sql chain. Minimize the database connection permissions as much as possible.</p>
  </li>
</ul>

<h2 id="generate-answer">Generate Answer</h2>

<ul>
  <li>Finally, our last step generates an answer to the question given the information pulled from the database:</li>
</ul>

<h2 id="human-in-the-loop">Human-in-the-loop</h2>

<ul>
  <li>HIL workflows enable human intervention at any point in an automated process.</li>
</ul>

<h3 id="key-capabilities">key capabilities</h3>

<ul>
  <li>
    <p>Persistent execution state: LangGraph checkpoints the graph state after each step, allowing execution to pause indefinitely at defined nodes. This supports asynchronous human review or input without time constraints.</p>
  </li>
  <li>
    <p>Flexible integration points: HIL logic can be introduced at any point in the workflow. This allows targeted human involvement, such as approving API calls, correcting outputs, or guiding conversations.</p>
  </li>
</ul>

<h3 id="typical-use-cases">Typical use cases¬∂</h3>

<ul>
  <li>
    <p>üõ†Ô∏è Reviewing tool calls: Humans can review, edit, or approve tool calls requested by the LLM before tool execution.</p>
  </li>
  <li>
    <p>‚úÖ Validating LLM outputs: Humans can review, edit, or approve content generated by the LLM.</p>
  </li>
  <li>
    <p>üí° Providing context: Enable the LLM to explicitly request human input for clarification or additional details or to support multi-turn conversations.</p>
  </li>
</ul>

<h3 id="implementation">Implementation¬∂</h3>

<ul>
  <li>
    <p>interrupt function: Pauses execution at a specific point, presents information for human review.</p>
  </li>
  <li>
    <p>Command primitive: Used to resume execution with a value provided by the human.</p>
  </li>
</ul>

<h2 id="persistence">Persistence</h2>

<ul>
  <li>
    <p>LangGraph has a built-in persistence layer, implemented through checkpointers. When you compile graph with a checkpointer, the checkpointer saves a checkpoint of the graph state at every super-step. Those checkpoints are saved to a thread, which can be accessed after graph execution. Because threads allow access to graph‚Äôs state after execution, several powerful capabilities including human-in-the-loop, memory, time travel, and fault-tolerance are all possible. 
<img src="/notes/assets/img/posts/image-1.png" alt=""></p>
  </li>
  <li>
    <p>Threads: A thread is a unique ID assigned to each checkpoint saved by a checkpointer.</p>
  </li>
  <li>
    <p>Checkpoints: It is a snapshot of the graph state saved at each super-step and is represented by StateSnapshot object.</p>
  </li>
  <li>
    <p>InMemorySaver: this checkpoint saver stores checkpoints in memory using a defaultdict.</p>
  </li>
</ul>

<h2 id="agents">Agents</h2>

<ul>
  <li>
    <p>By themselves, language models can‚Äôt take actions - they just output text. Agents are systems that take a high-level task and use an LLM as a reasoning engine to decide what actions to take and execute those actions.</p>
  </li>
  <li>
    <p>Using agents allows you to offload additional discretion over the query generation and execution process. Although their behavior is less predictable than the above ‚Äúchain‚Äù, they feature some advantages:</p>
  </li>
  <li>
    <ul>
      <li>They can query the database as many times as needed to answer the user question.</li>
    </ul>
  </li>
  <li>
    <ul>
      <li>They can recover from errors by running a generated query, catching the traceback and regenerating it correctly.</li>
    </ul>
  </li>
  <li>
    <ul>
      <li>They can answer questions based on the databases‚Äô schema as well as on the databases‚Äô content (like describing a specific table).</li>
    </ul>
  </li>
</ul>

<h2 id="dealing-with-high-cardinality-columns">Dealing with high-cardinality columns</h2>

<ul>
  <li>
    <p>In order to filter columns that contain proper nouns such as addresses, song names or artists, we first need to double-check the spelling in order to filter the data correctly.</p>
  </li>
  <li>
    <p>We can achieve this by creating a vector store with all the distinct proper nouns that exist in the database. We can then have the agent query that vector store each time the user includes a proper noun in their question, to find the correct spelling for that word. In this way, the agent can make sure it understands which entity the user is referring to before building the target query.</p>
  </li>
</ul>

    </div>
  </article>

  

  

  
    
  

  
  
</div>
</div>
          </div>
        
      
    </div>

    <!-- Footer -->
    


  <footer class="sticky-bottom mt-5" role="contentinfo">
    

    <div class="container">
      
  ¬© Copyright 2025
  Neural
  
  Notes. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme.

  
  
    Last updated: November 27, 2025.
  

    </div>
  </footer>



    <!-- JavaScripts -->
    <!-- jQuery -->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

<!-- Bootsrap & MDB scripts -->
<script src="/notes/assets/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script>


  <!-- Masonry & imagesLoaded -->
  <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script>
  <script defer src="" integrity="" crossorigin="anonymous"></script>
  <script defer src="/notes/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script>























  <!-- Medium Zoom JS -->
  <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script>
  <script defer src="/notes/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script>



  <!-- Sidebar Table of Contents -->
  <script defer src="/notes/assets/js/bootstrap-toc.min.js?c82ff4de8b0955d6ff14f5b05eed7eb6"></script>




<!-- Load Common JS -->
<script src="/notes/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script>
<script defer src="/notes/assets/js/common.js?c15de51d4bb57887caa2c21988d97279"></script>
<script defer src="/notes/assets/js/copy_code.js?c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script>

<!-- Jupyter Open External Links New Tab -->
<script defer src="/notes/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script>

<!-- Badges -->




  <!-- MathJax -->
  <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script>
  
    <script src="/notes/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script>
    <script defer src="" crossorigin="anonymous"></script>
  









  <!-- Scrolling Progress Bar -->
  <script defer src="/notes/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script>







  <!-- Back to Top -->
  <script src="/notes/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script>
  <script>
    addBackToTop();
  </script>



  <!-- Search -->
  <script type="module" src="/notes/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script>
  <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys>
  <script src="/notes/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script>
  <script src="/notes/assets/js/search-data.js"></script>
  <script src="/notes/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script>




  </body>
</html>
